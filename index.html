<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Baby Calculator</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- Leave those next 4 lines if you care about users using IE8 -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	

</head>

<body>

    <div class="container">

      <div class="template">
        <h1>Baby Calculator</h1>
        <p class="lead">Différents outils pour calculer la date de fécondation ou d'accouchement prévue, ou encore l'âge de votre bébé.</p>
		
		<div class="jumbotron">
			<form id="formulaire">
				<p>Indiquez le premier jour de vos dernières règles: <input id="datePicker" class="form-control" type="date"></p>
				<p>Quelle est la durée de vos cycles: 
				<select id="cyclePicker" class="form-control">
					<option value="26">26 jours</option> 
					<option value="27">27 jours</option>
					<option value="28" selected>28 jours</option>
					<option value="29">29 jours</option>
					<option value="30">30 jours</option>
					<option value="31">31 jours</option>
					<option value="32">32 jours</option>
				</select></p>
				<button class="btn btn-default" type="submit">Calculer</button>
			</form>
        </div>
		
		<div class="panel panel-default">
		  <div class="panel-body" id="resultats">
			
		  </div>
		</div>
      </div>

    </div>

    <!-- Including Bootstrap JS (with its jQuery dependency) so that dynamic components work -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
	
	<script>
		$(document).ready( function() {
			//var queryString = window.location.search.slice(1);
			var params = getAllUrlParams();
			var date = params.date;
			var cycle = params.cycle;
			$('#datePicker').val(new Date(date).toDateInputValue());
			$('#cyclePicker').val(cycle);
			$( ".panel" ).hide();
			
			$( "#formulaire" ).submit(function( event ) {
				event.preventDefault();
				
				var text = "";
				
				var date = new Date($('#datePicker').val());
				var cycle = parseInt($('#cyclePicker').val());
				
				var now = new Date();
				now.setHours(0,0,0,0);
				
				// Amenorrhee
				text += "<h2>Amenorrhee</h2>";
				var joursAmenorrhee = 0;
				var semainesAmenorrhee = 0;
				var semainesJoursAmenorrhee = 0;
				
				joursAmenorrhee = Math.floor((now.getTime() - date.getTime())/(1000*60*60*24.)) + 1;
				console.log(joursAmenorrhee);
				semainesAmenorrhee = (joursAmenorrhee - joursAmenorrhee % 7) / 7 + 1;
				console.log(semainesAmenorrhee);
				text += "<p>Vous êtes dans votre " + semainesAmenorrhee + "<sup>ème</sup> semaines d'aménorrhée (SA).</p>";
				
				// Date Fecondation
				text += "<h2>Fécondation</h2>";
				var fecondationDate = new Date(date);
				fecondationDate.setDate(date.getDate() + cycle - 14);
				text += "<p>La date de fécondation estimée est le " + fecondationDate.toLocaleDateString() + ".</p>";
				
				// Temps depuis fecondation
				text += "<h2>Grossesse</h2>";
				var joursFecondation = 0;
				var semainesFecondation = 0;
				
				joursFecondation = Math.floor((now.getTime() - fecondationDate.getTime())/(1000*60*60*24.)) + 1;
				console.log(joursFecondation);
				semainesFecondation = (joursFecondation - joursFecondation % 7) / 7 + 1;
				console.log(semainesFecondation);
				
				text += "<p>Votre petit bébé a " + joursFecondation + " jours.</p>";
				text += "<p>Vous êtes dans votre " + semainesFecondation + "<sup>ème</sup> semaines de grossess (SG).</p>";
				
				$( "#resultats" ).append(text);
				$( ".panel" ).show();
			});
		});
		
		Date.prototype.toDateInputValue = (function() {
			var local = new Date(this);
			local.setMinutes(this.getMinutes() - this.getTimezoneOffset());
			return local.toJSON().slice(0,10);
		});
	</script>
</body>

</html>



<script>
function getAllUrlParams(url) {
  // get query string from url (optional) or window
  var queryString = url ? url.split('?')[1] : window.location.search.slice(1);

  // we'll store the parameters here
  var obj = {};

  // if query string exists
  if (queryString) {

    // stuff after # is not part of query string, so get rid of it
    queryString = queryString.split('#')[0];

    // split our query string into its component parts
    var arr = queryString.split('&');

    for (var i=0; i<arr.length; i++) {
      // separate the keys and the values
      var a = arr[i].split('=');

      // in case params look like: list[]=thing1&list[]=thing2
      var paramNum = undefined;
      var paramName = a[0].replace(/\[\d*\]/, function(v) {
        paramNum = v.slice(1,-1);
        return '';
      });

      // set parameter value (use 'true' if empty)
      var paramValue = typeof(a[1])==='undefined' ? true : a[1];

      // (optional) keep case consistent
      paramName = paramName.toLowerCase();
      paramValue = paramValue.toLowerCase();

      // if parameter name already exists
      if (obj[paramName]) {
        // convert value to array (if still string)
        if (typeof obj[paramName] === 'string') {
          obj[paramName] = [obj[paramName]];
        }
        // if no array index number specified...
        if (typeof paramNum === 'undefined') {
          // put the value on the end of the array
          obj[paramName].push(paramValue);
        }
        // if array index number specified...
        else {
          // put the value at that index number
          obj[paramName][paramNum] = paramValue;
        }
      }
      // if param name doesn't exist yet, set it
      else {
        obj[paramName] = paramValue;
      }
    }
  }

  return obj;
}
</script>
